
{% load humanize %}

<style>
/* Navbar styling */
.navbar {
    background-color: #111827;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.navbar-links {
    display: flex;
    gap: 20px;
}

.navbar a {
    color: white;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
}

.navbar a:hover {
    color: #fbbf24;
}

.nav-button {
    background-color: #fbbf24;
    color: #1f2933 !important;
    padding: 8px 16px;
    border-radius: 5px;
    font-weight: 600;
}

.nav-button:hover {
    background-color: #f59e0b;
    color: #1f2933 !important;
}

/* Card styling */
.card {
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin-top: 10px;
}

th {
    background-color: #111;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: 600;
}

td {
    padding: 8px;
    text-align: center;
}

tr:nth-child(even) {
    background-color: #f5f5f5;
}

.pos {
    color: #00b894;
    font-weight: 600;
}

.neg {
    color: #d63031;
    font-weight: 600;
}

.rsi-high {
    color: #d63031;
    font-weight: 600;
}

.rsi-low {
    color: #00b894;
    font-weight: 600;
}

.table-container {
    overflow-x: auto;
}
</style>

<!-- Full Navigation Bar -->
<div class="navbar">
    <div class="navbar-links">
        <a href="{% url 'base' %}">Home</a>  <!-- This will go to '/' -->
        <a href="{% url 'dashboard' %}">Dashboard</a>
        <a href="{% url 'analysis' %}">Analysis</a>
        <a href="{% url 'ranking' %}">Ranking</a>
        <a href="{% url 'backtest' %}">Backtest</a>
        <a href="{% url 'iv' %}">IV Analysis</a>
        <a href="{% url 'trade_log' %}">Trade Log</a>
    </div>
    <a href="/"  class="nav-button">üè† Volver al Inicio</a>
    
</div>

<div class="card">
    <!-- Add Stock -->
    <h3>Add Stock</h3>
    <form method="POST" action="{% url 'add_stock' %}">
        {% csrf_token %}
        <input type="text" name="ticker" placeholder="Enter ticker (e.g. TSLA)" required>
        <button type="submit">Add</button>
    </form>

    <hr>

    <!-- Watchlist -->
    <h3>üìà Watchlist</h3>

    <div class="table-container">
    <table>
        <tr>
            <th>Ticker</th>
            <th>Price</th>
            <th>1D %</th>
            <th>5D %</th>
            <th>20D %</th>
            <th>Vol Ratio</th>
            <th>Vol 5D</th>
            <th>Vol 20D</th>
            <th>RSI</th>
            <th>Volume</th>
            <th>High</th>
            <th>Low</th>
            <th>Alpha</th>
            <th>Remove</th>
        </tr>

        {% for stock in stocks %}
        <tr>
            <td><strong>{{ stock.ticker }}</strong></td>
            <td>${{ stock.price|floatformat:2 }}</td>
            <td class="{% if stock.change_pct > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.change_pct|floatformat:2 }}%
            </td>
            <td class="{% if stock.perf_5d > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.perf_5d|floatformat:2 }}%
            </td>
            <td class="{% if stock.perf_20d > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.perf_20d|floatformat:2 }}%
            </td>
            <td>{{ stock.volume_ratio|floatformat:2 }}</td>
            <td>{{ stock.volatility_5d|floatformat:2 }}</td>
            <td>{{ stock.volatility_20d|floatformat:2 }}</td>
            <td class="
                {% if stock.rsi > 70 %}rsi-high
                {% elif stock.rsi < 30 %}rsi-low{% endif %}">
                {{ stock.rsi|floatformat:1 }}
            </td>
            <td>{{ stock.volume|intcomma }}</td>
            <td>{{ stock.high|floatformat:2 }}</td>
            <td>{{ stock.low|floatformat:2 }}</td>
            <td>{{ stock.alpha_score }}</td>
            <td>
                <a href="{% url 'remove_stock' stock.ticker %}">‚ùå</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="14">No watchlist data available.</td>
        </tr>
        {% endfor %}
    </table>
    </div>
</div>




<!-- Watchlist Tab -->
<div id="tab-watchlist" class="tab-content active">
    <div class="card">
        <h3>üìä Market Watchlist</h3>
        <button onclick="refreshWatchlist()" class="btn btn-primary">üîÑ Refresh Data</button>
        <div id="watchlist-loader" class="loader" style="display: none;"></div>
        <div id="watchlist-table"></div>
    </div>
</div>

<script>
// Watchlist functions
async function refreshWatchlist() {
    const loader = document.getElementById('watchlist-loader');
    const table = document.getElementById('watchlist-table');
    
    loader.style.display = 'block';
    table.innerHTML = '';
    
    try {
        const response = await fetch('/api/trading/watchlist/');
        const data = await response.json();
        
        if (data.success && data.data.length > 0) {
            let html = '<table class="data-table"><tr>';
            
            // Headers
            Object.keys(data.data[0]).forEach(key => {
                html += `<th>${key}</th>`;
            });
            html += '</tr>';
            
            // Data rows
            data.data.forEach(row => {
                html += '<tr>';
                Object.entries(row).forEach(([key, val]) => {
                    let className = '';
                    if (typeof val === 'number') {
                        className = val > 0 ? 'positive' : val < 0 ? 'negative' : '';
                    }
                    html += `<td class="${className}">${typeof val === 'number' ? val.toFixed(2) : val}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';
            table.innerHTML = html;
        } else {
            table.innerHTML = '<p>No data available</p>';
        }
    } catch (error) {
        table.innerHTML = `<p class="negative">Error: ${error}</p>`;
    }
    
    loader.style.display = 'none';
}

</script>

