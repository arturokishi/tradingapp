{% extends "core/base.html" %}
{% load humanize %}

{% block content %}

<style>
.card {
    padding: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin-top: 10px;
}

th {
    background-color: #111;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: 600;
}

td {
    padding: 8px;
    text-align: center;
}

tr:nth-child(even) {
    background-color: #f5f5f5;
}

.pos {
    color: #00b894;
    font-weight: 600;
}

.neg {
    color: #d63031;
    font-weight: 600;
}

.rsi-high {
    color: #d63031;
    font-weight: 600;
}

.rsi-low {
    color: #00b894;
    font-weight: 600;
}

.table-container {
    overflow-x: auto;
}

/* Navbar button styling */
.nav-button {
    background-color: #fbbf24;
    color: #1f2933;
    padding: 8px 16px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: 600;
    margin-left: 20px;
}

.nav-button:hover {
    background-color: #f59e0b;
}
</style>

<!-- Navbar with button to base.html -->
<div style="background-color: #1f2933; padding: 15px 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
    <h2 style="color: white; margin: 0;">üìä Trading Dashboard</h2>
    <a href="{% url 'base' %}" class="nav-button">üè† Volver al Inicio</a>
</div>

<div class="card">
    <!-- Add Stock -->
    <h3>Add Stock</h3>
    <form method="POST" action="{% url 'add_stock' %}">
        {% csrf_token %}
        <input type="text" name="ticker" placeholder="Enter ticker (e.g. TSLA)" required>
        <button type="submit">Add</button>
    </form>

    <hr>

    <!-- Watchlist -->
    <h3>üìà Watchlist</h3>

    <div class="table-container">
    <table>
        <tr>
            <th>Ticker</th>
            <th>Price</th>
            <th>1D %</th>
            <th>5D %</th>
            <th>20D %</th>
            <th>Vol Ratio</th>
            <th>Vol 5D</th>
            <th>Vol 20D</th>
            <th>RSI</th>
            <th>Volume</th>
            <th>High</th>
            <th>Low</th>
            <th>Alpha</th>
            <th>Remove</th>  <!-- Removed Sentiment column -->
        </tr>

        {% for stock in stocks %}
        <tr>
            <td><strong>{{ stock.ticker }}</strong></td>

            <td>${{ stock.price|floatformat:2 }}</td>

            <td class="{% if stock.change_pct > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.change_pct|floatformat:2 }}%
            </td>

            <td class="{% if stock.perf_5d > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.perf_5d|floatformat:2 }}%
            </td>

            <td class="{% if stock.perf_20d > 0 %}pos{% else %}neg{% endif %}">
                {{ stock.perf_20d|floatformat:2 }}%
            </td>

            <td>{{ stock.volume_ratio|floatformat:2 }}</td>
            <td>{{ stock.volatility_5d|floatformat:2 }}</td>
            <td>{{ stock.volatility_20d|floatformat:2 }}</td>

            <td class="
                {% if stock.rsi > 70 %}
                    rsi-high
                {% elif stock.rsi < 30 %}
                    rsi-low
                {% endif %}
            ">
                {{ stock.rsi|floatformat:1 }}
            </td>

            <td>{{ stock.volume|intcomma }}</td>
            <td>{{ stock.high|floatformat:2 }}</td>
            <td>{{ stock.low|floatformat:2 }}</td>

            <td>{{ stock.alpha_score }}</td>

            <td>
                <a href="{% url 'remove_stock' stock.ticker %}">‚ùå</a>
            </td>
        </tr>

        {% empty %}
        <tr>
            <td colspan="14">No watchlist data available.</td>  <!-- Reduced colspan from 15 to 14 -->
        </tr>
        {% endfor %}
    </table>
    </div>

    <hr>

    <!-- Momentum Ranking -->
    <h3>üèÜ Momentum Ranking</h3>

    <div class="table-container">
    <table>
        <tr>
            <th>Ticker</th>
            <th>Momentum</th>
        </tr>

        {% for stock in ranking %}
        <tr>
            <td><strong>{{ stock.ticker }}</strong></td>
            <td>{{ stock.momentum|floatformat:4 }}</td>
        </tr>

        {% empty %}
        <tr>
            <td colspan="2">No ranking data available.</td>
        </tr>
        {% endfor %}
    </table>
    </div>

</div>

<div class="card">
    <h3>üìä Watchlist</h3>

    {% if stocks %}
        <table width="100%" style="border-collapse: collapse;">
            <tr style="text-align:left;">
                <th>Ticker</th>
                <th>Price</th>
                <th>1D %</th>
                <th>5D %</th>
                <th>Momentum</th>
            </tr>

            {% for stock in stocks %}
            <tr style="border-top:1px solid #eee;">
                <td><strong>{{ stock.ticker }}</strong></td>
                <td>${{ stock.price }}</td>

                <td style="color:{% if stock.change_pct > 0 %}green{% else %}red{% endif %};">
                    {{ stock.change_pct }}%
                </td>

                <td style="color:{% if stock.perf_5d > 0 %}green{% else %}red{% endif %};">
                    {{ stock.perf_5d }}%
                </td>

                <td>{{ stock.momentum }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No watchlist data available.</p>
    {% endif %}
</div>

{% endblock %}



